# In newer versions of this board shipped in late 2021 the STM32F429
# is used, if this is the case compile for this with a "32KiB bootloader"
# You will need to check the chip on your board to identify which you have.
#
# The "make flash" command does not work on the SKR 2. Instead,
# after running "make", copy the generated "out/klipper.bin" file to a
# file named "firmware.bin" on an SD card and then restart the SKR 2
# with that SD card.

# See docs/Config_Reference.md for a description of parameters.

# Note: The initial revision of this board has a flaw that can cause
# damage to itself and other boards. Be sure to verify the board is
# not impacted by this flaw before using it.

[include mainsail.cfg]
[include Macros.cfg]
[include TMC_MTRCFG.cfg]

[include D3MINI/00_MCU.cfg]
[include D3MINI/01_XYZ_Motor.cfg]
[include D3MINI/02_Extruder.cfg]
[include D3MINI/03_TMC2209.cfg]
[include D3MINI/04_Fans.cfg]
[include D3MINI/05_Probe.cfg]
[include D3MINI/D3MINI.cfg]


[printer]
kinematics: limited_cartesian
max_x_velocity: 200
max_y_velocity: 200
max_z_velocity: 12
max_velocity: 283
#   In order to get maximum velocity gains on diagonals, this should be equal or
#   greater than the hypotenuse (sqrt(x*x + y*y)) of max_x_velocity and
#   max_y_velocity.
max_x_accel: 1000
max_y_accel: 1000
max_z_accel: 200
max_accel: 1000
scale_xy_accel: False
#   When true, scales the XY limits by the current tool head acceleration.
#   The factor is: slicer accel / hypot(max_x_accel, max_y_accel).
#   See below.

[extruder]
heater_pin: OUT1
sensor_type: PT1000
sensor_pin: TEMP1
pullup_resistor: 4700
smooth_time: 1.0
control: pid_v
pid_Kp: 22.2
pid_Ki: 1.08
pid_Kd: 114
#control: mpc
#heater_power: 80
#cooling_fan: fan
#filament_diameter: 1.75
#filament_density: 1.27 #PETG
#filament_heat_capacity: 2.20 #PETG
#block_heat_capacity: 16.9467
#sensor_responsiveness: 0.0407818
#ambient_transfer: 0.114184
#fan_ambient_transfer: 0.114184, 0.120981, 0.123553, 0.129388, 0.130306, 0.134889, 0.135537, 0.139678, 0.1398, 0.139161, 0.144778
min_extrude_temp: 170
min_temp: 0
max_temp: 500
per_move_pressure_advance: False
#   If true, uses pressure advance constant from trapq when processing moves
#   This causes changes to pressure advance be taken into account immediately,
#   for all moves in the current queue, rather than ~250ms later once the queue gets flushed

[heater_bed]
heater_pin: OUT0
sensor_type: EPCOS 100K B57560G104F
sensor_pin: TEMP0
#control: pid_v
#pid_Kp: 22.2
#pid_Ki: 1.08
#pid_Kd: 114
min_temp: 0
max_temp: 125

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [extruder]
#*# control = mpc
#*# block_heat_capacity = 17.9370
#*# sensor_responsiveness = 0.0822222
#*# ambient_transfer = 0.114368
#*# fan_ambient_transfer = 0.114368, 0.110889, 0.119383, 0.117331, 0.124822, 0.131766, 0.128292, 0.128687, 0.128889, 0.131275, 0.128564, 0.139645, 0.133714, 0.136812, 0.136696, 0.140297, 0.137327, 0.141975, 0.140876, 0.144696
#*#
#*# [heater_bed]
#*# pid_version = 1
#*# pid_target = 70.00
#*# pid_tolerance = 0.0200
#*# control = pid_v
#*# pid_kp = 40.572
#*# pid_ki = 0.502
#*# pid_kd = 819.556
